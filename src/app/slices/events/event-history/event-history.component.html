<div class="card">
  <div class="card-header flex justify-between items-center">
    <span>Event History</span>
  </div>

  <!-- Controls row: date picker, load button, toggle, topic select -->
  <div class="controls-row">
    <input type="date" [(ngModel)]="selectedDate" class="date-input" />

    <button class="load-btn" (click)="onLoadEvents()">🔍 Load Events</button>

    <div class="toggle-container">
      <label class="switch">
        <input type="checkbox" [(ngModel)]="showMapView" (change)="onToggleView()" />
        <span class="slider round"></span>
      </label>
      <span class="view-label">{{ showMapView ? '🗺️ Map View' : '📄 List View' }}</span>
    </div>

    <select
      *ngIf="!showMapView"
      id="topicSelect"
      (change)="onTopicChange($event.target.value)"
      [value]="selectedTopicId"
      class="topic-select"
    >
      <option value="">All Topics</option>
      <option *ngFor="let topic of topics" [value]="topic.id">{{ topic.name }}</option>
    </select>
  </div>

  <!-- Map View -->
  <div *ngIf="showMapView" id="map" class="map-container"></div>

  <!-- List View -->
  <div *ngIf="!showMapView">
    <div *ngIf="pagedEvents.length > 0; else noData" class="event-list">
      <div *ngFor="let event of pagedEvents" class="event-card">
        <div class="event-header">
          <div class="event-title">
            <span class="event-icon">⚡</span>
            {{ event.eventInfo.title }}
          </div>
          <span *ngIf="event.isReviewed" class="reviewed-icon" title="Reviewed">✅</span>
        </div>

        <div class="event-summary">
          {{ event.eventInfo.summary || 'No summary available.' }}
        </div>

        <div class="event-meta">
          <span class="icon-calendar">{{ event.createdAt | date: 'shortDate' }}</span>
          <span *ngIf="event.topic" class="icon-tag">{{ event.topic.name }}</span>

          <div class="event-footer">
            <button class="view-button" [routerLink]="['/events/view', event.id]">
              <i class="fas fa-eye"></i> View
            </button>
          </div>
        </div>
      </div>

      <button
        *ngIf="currentIndex < events.length"
        class="load-more-btn"
        (click)="loadMore()"
      >
        Load More
      </button>
    </div>
  </div>

  <!-- No data -->
  <ng-template #noData>
    <div class="no-data" *ngIf="selectedDate">No events found for the selected date.</div>
    <div class="no-data" *ngIf="!selectedDate">Please select a date and click "Load Events".</div>
  </ng-template>
</div>
